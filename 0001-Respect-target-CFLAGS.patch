From 34af1b06b412c19c66181b022608c872d4b4cbcb Mon Sep 17 00:00:00 2001
From: Vitaly Zaitsev <vitaly@easycoding.org>
Date: Thu, 22 Jun 2017 19:06:52 +0200
Subject: [PATCH] Respect target CFLAGS. Added LDFLAGS. Fixed incorrect chmod
 on shared library and icons.

---
 Makefile.common | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/Makefile.common b/Makefile.common
index 05dc040..212d569 100644
--- a/Makefile.common
+++ b/Makefile.common
@@ -1,9 +1,10 @@
 # common parts of Makefile and Makefile.mingw
 
-COMPILE.c = $(CC) $(CFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c
+COMPILE.c = $(CC) $(CFLAGS) $(LDFLAGS) $(CPPFLAGS) $(TARGET_ARCH) -c
 
-CFLAGS+=-Wall -g -O0 -Werror
+CFLAGS ?= -Wall -g -O0 -Werror
 CFLAGS += -DPURPLE_PLUGINS 
+LDFLAGS ?= -Wl,-z,relro 
 
 # generate .d files when compiling
 CPPFLAGS += -MMD
@@ -22,10 +23,10 @@ clean:
 
 install:
 	mkdir -p $(DESTDIR)$(PLUGIN_DIR_PURPLE)
-	install -m 664 $(TARGET) $(DESTDIR)$(PLUGIN_DIR_PURPLE)
+	install -m 0755 $(TARGET) $(DESTDIR)$(PLUGIN_DIR_PURPLE)
 	for i in 16 22 48; do \
 	    mkdir -p $(DESTDIR)$(DATA_ROOT_DIR_PURPLE)/pixmaps/pidgin/protocols/$$i; \
-	    install -m 664 matrix-$${i}px.png $(DESTDIR)$(DATA_ROOT_DIR_PURPLE)/pixmaps/pidgin/protocols/$$i/matrix.png; \
+	    install -m 0644 -p matrix-$${i}px.png $(DESTDIR)$(DATA_ROOT_DIR_PURPLE)/pixmaps/pidgin/protocols/$$i/matrix.png; \
 	done
 
 $(TARGET): $(OBJECTS)
-- 
2.9.4

